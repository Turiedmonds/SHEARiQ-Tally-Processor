
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>SHEAR iQ Tally Sheet</title>
<style>
        body { font-family: Arial, sans-serif; background: #111; color: #fff; padding: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #555; padding: 8px; text-align: center; }
        th { background: #222; }
        input[type="number"], input[type="text"], select {
            width: 100%; padding: 6px; box-sizing: border-box;
        }
        #add-stand-btn {
            margin-top: 10px; padding: 8px 12px; background: #444; color: #fff; border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h2>SHEAR iQ Tally Sheet</h2>
<label>Station Name:</label><br/>
<input id="stationName" type="text"/><br/><br/>
<label>Team Leader:</label><br/>
<input id="teamLeader" type="text"/><br/><br/>
<label>Date:</label><br/>
<input id="date" type="date"/><br/><br/>
<label>Comb Type:</label><br/>
<input id="combType" placeholder="e.g. Cover Comb" type="text"/><br/><br/>

<div style="margin-top: 10px;">
<label for="farmerName">Farmer Name:</label>
<input id="farmerName" placeholder="Enter farmer name" style="width: 100%; margin-bottom: 5px;" type="text"/>
<div style="display: flex; gap: 10px; margin-bottom: 5px;">
<div style="flex: 1;">
<label for="startTime">Start Time:</label>
<input id="startTime" style="width: 100%;" type="time"/>
</div>
<div style="flex: 1;">
<label for="finishTime">Finish Time:</label>
<input id="finishTime" style="width: 100%;" type="time"/>
</div>
<div style="flex: 1;">
<label for="hoursWorked">Hours Worked:</label>
<input id="hoursWorked" placeholder="Enter hours worked" style="width: 100%;" type="text"/>
</div>
</div>
</div>
<h3>Shearers (Excel Layout)</h3>
<button id="add-stand-btn" onclick="addStand()">Add Stand</button>
<table id="tallyTable">
<thead>
<tr id="headerRow">
<th>Run #</th>
<th>Stand 1<br/><input placeholder="Name" type="text"/></th>
<th>Stand 2<br/><input placeholder="Name" type="text"/></th>
<th>Stand 3<br/><input placeholder="Name" type="text"/></th>
<th>Stand 4<br/><input placeholder="Name" type="text"/></th>
<th>Run Total</th>
<th>Sheep Type</th>
</tr>
</thead>
<tbody id="tallyBody">
<!-- Run rows -->
</tbody>
<tfoot>
<tr id="subtotalRow">
<th>Subtotal</th>
</tr>
</tfoot>
</table>
<script>
        let numStands = 4;
        const runs = 4;

        function createRow(runIndex) {
            const row = document.createElement("tr");
            row.innerHTML = `<td>Run ${runIndex + 1}</td>`;
            for (let i = 0; i < numStands; i++) {
                row.innerHTML += `<td><input type="number" value="0" onchange="updateTotals()"></td>`;
            }
            row.innerHTML += `<td class="run-total">0</td>`;
            row.innerHTML += `<td><select><option>Other</option><option>Long Tails</option><option>Uncrutched</option><option>Fly Blow</option><option>Wether Lambs</option><option>Ewe Lambs</option><option>Mixed Lambs</option><option>Merino Lambs</option><option>2nd Shear Ewes</option><option>Full Wool</option><option>Half Bred Ewes</option><option>1/4 Bred Ewes</option><option>Corridale Ewes</option><option>Merino Ewes</option><option>Merino Wethers</option><option>Rams</option><option>Stud Rams</option><option>Merino Rams</option><option>Merino Stud Rams</option></select></td>`;
            return row;
        }

        function addStand() {
            numStands++;
            const header = document.getElementById("headerRow");
            const newHeader = document.createElement("th");
            newHeader.innerHTML = `Stand ${numStands}<br><input type="text" placeholder="Name">`;
            header.insertBefore(newHeader, header.children[header.children.length - 2]);

            const tallyBody = document.getElementById("tallyBody");
            for (let i = 0; i < runs; i++) {
                const row = tallyBody.children[i];
                const cell = document.createElement("td");
                cell.innerHTML = `<input type="number" value="0" onchange="updateTotals()">`;
                row.insertBefore(cell, row.children[row.children.length - 2]);
            }

            const subtotalRow = document.getElementById("subtotalRow");
            const cell = document.createElement("td");
            cell.innerText = "0";
            subtotalRow.insertBefore(cell, subtotalRow.children[subtotalRow.children.length - 2]);
        }

        function updateTotals() {
            const tbody = document.getElementById("tallyBody");
            let dailyTotal = 0;
            for (let i = 0; i < tbody.children.length; i++) {
                const row = tbody.children[i];
                let total = 0;
                for (let j = 1; j <= numStands; j++) {
                    total += Number(row.children[j].children[0].value);
                }
                row.querySelector(".run-total").innerText = total;
                dailyTotal += total;
            }

            const subtotalRow = document.getElementById("subtotalRow");
            for (let i = 1; i <= numStands; i++) {
                let colTotal = 0;
                for (let j = 0; j < tbody.children.length; j++) {
                    colTotal += Number(tbody.children[j].children[i].children[0].value);
                }
                subtotalRow.children[i].innerText = colTotal;
            }
            subtotalRow.children[numStands + 1].innerText = dailyTotal;
        }

        // Initialize table with default rows
        for (let i = 0; i < runs; i++) {
            document.getElementById("tallyBody").appendChild(createRow(i));
        }

        // Init subtotal row
        const subtotalRow = document.getElementById("subtotalRow");
        for (let i = 0; i < numStands; i++) {
            const cell = document.createElement("td");
            cell.innerText = "0";
            subtotalRow.appendChild(cell);
        }
        subtotalRow.innerHTML += `<td></td><td></td>`;
    </script>
<div class="section">
<h2>Shed Staff</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Hours Worked</th>
</tr>
</thead>
<tbody id="shedStaffTable">
<tr>
<td><input placeholder="Staff Name" type="text"/></td>
<td><input min="0" placeholder="0" step="0.1" type="number"/></td>
</tr>
<tr>
<td><input placeholder="Staff Name" type="text"/></td>
<td><input min="0" placeholder="0" step="0.1" type="number"/></td>
</tr>
</tbody>
</table>
</div>

<script>
function calculateHoursWorked() {
    const startInput = document.getElementById("startTime");
    const endInput = document.getElementById("finishTime");
    const output = document.getElementById("hoursWorked");

    if (!startInput || !endInput || !output) return;

    const start = new Date("1970-01-01T" + startInput.value);
    const end = new Date("1970-01-01T" + endInput.value);

    if (isNaN(start.getTime()) || isNaN(end.getTime())) {
        output.value = "";
        return;
    }

    let totalHours = (end - start) / (1000 * 60 * 60);

    const breaks = [
        ["09:00", "09:30"],
        ["11:30", "12:30"],
        ["14:30", "15:00"]
    ];

    breaks.forEach(b => {
        const bStart = new Date("1970-01-01T" + b[0]);
        const bEnd = new Date("1970-01-01T" + b[1]);

        if (end > bStart && start < bEnd) {
            const overlapStart = new Date(Math.max(start, bStart));
            const overlapEnd = new Date(Math.min(end, bEnd));
            totalHours -= (overlapEnd - overlapStart) / (1000 * 60 * 60);
        }
    });

    output.value = totalHours > 0 ? totalHours.toFixed(2) : "0";
}

document.addEventListener("DOMContentLoaded", function () {
    const start = document.getElementById("startTime");
    const end = document.getElementById("finishTime");
    if (start) start.addEventListener("change", calculateHoursWorked);
    if (end) end.addEventListener("change", calculateHoursWorked);
});
</script>

</body>
</html>
